# Item 71 - 필요 없는 검사 예외 사용은 피하라

> 작성자: 럭키

### 검사 예외(Checked Exception)
- 개발자가 명시해야 하는 부분은 검사 예외인 Exception으로 어플리케이션 수행 중 일어날 법한 예외를 검사하고 대비하라는 목적으로 사용한다.
- 컴파일 단계에서 컴파일러가 체크한다. 이를 처리하지 않으면 컴파일 에러가 발생한다.
- 과도한 예외 검출은 시스템의 성능을 저하시킬 수 있다.
- 대표적으로 IOException, SQLException 등이 있다.

### 비검사 예외(Unchecked Exception)
- Error는 시스템적인 예외를 의미한다. 개발자가 예외를 try-catch 로 잡지 않았을 때 발생한다.
- 런타임에 컴파일러에게 예외가 걸리지지 않았을 경우 발생한다. 즉, 코드 상의 문제이다.
- 대표적으로 RuntimeException, NullPointerException, OutOfBoundsException 등이 있다.

### 검사 예외(Checked Exception)의 문제점

- 검사 예외는 제대로 활용하면 API와 프로그램의 질을 높일 수 있다.
- 하지만 남발하면 쓰기 불편한 API가 된다. try-catch 혹은 throws 를 강제하기 때문이다.
- 이 과정에서 많은 개발자들이 귀찮다는 이유로 잘못된 예외 처리 로직을 작성하거나 예외처리 로직에서 아무 행위도 하지 않기도 한다.
- 검사 예외가 발생하는 메서드는 스트림 안에서 해당 메서드를 직접 사용할 수 없다.
- 더 나은 방식이 없다면 비검사 예외를 사용해야 한다.
- 메서드가 단 하나의 검사 예외만 던질 때가 특히 크다.
- 단, 프로그래머가 검사 예외로 인해 의미있는 조치를 취할 수 있다면 괜찮은 조치일 수도 있다.

예외 상황에 대처하지 못하는 경우
```java
try {
  // ...
} catch (TheCheckedException e) {
  throw new AssertionError(); // 일어날 수 없다!
}

try {
  // ...
} catch (TheCheckedException e) {
  e.printStackTrace(); // 이런, 우리가 졌다!
  System.exit(1);
}
```

개발자가 검사 예외를 저렇게 처리한다면, 차라리 비검사 예외로 처리하는 것이 나을 것이다.

### 검사 예외를 회피하는 가장 쉬운 방법 1: Optional

- 적절한 결과 타입을 담은 옵셔널을 반환하는 것이다.
- 검사 예외를 던지는 대신 빈 옵셔널을 반환하는 방식을 사용하는 것이다.
- 단, 옵셔널을 사용하면, 예외가 발생한 이유를 알려주는 부가정보는 담을 수 없을 것이다.
- 예외를 사용하면, 구체적인 예외 타입과 메서드를 활용해 부가정보를 담을 수 있다.

### 검사 예외를 회피하는 가장 쉬운 방법 2: 메서드를 2개로 쪼개기

- 메서드를 2개로 쪼개서 비검사 예외로 바꿀 수 있다.
- 예외가 던져질지 여부를 boolean 으로 처리한 뒤에 if 문으로 판단하는 것이다.
- catch 로 가는 것이 아니라 if (false) { ... } 로 가는 것이다.

검사 예외를 던지는 메서드 - 리팩터링 전
```java
try {
  obj.action(args);
} catch (TheCheckedException e) {
  // 예외 복구
}
```

상태 검사 메서드와 비검사 예외를 던지는 메서드 - 리팩터링 후
```java
if (obj.actionPermitted(args)) {
  obj.action(args);
} else {
  // 예외 복구
}
```

actionPermitted() 이 여러 스레드에서 동시에 접근된다면, 이 리팩터링은 적절치 않다.
actionPermitted() 와 action() 사이에 객체 상태가 변할 수 있다.
만일, actionPermitted() 와 action() 에 중복 수행이 있다면, 성능에서 손해라 역시 이 리팩터링은 적절치 않을 수도 있다.

## 핵심 정리
- 검사 예외는 필요한 곳에서는 프로그램의 안정성을 높여주는 장점이 있다.
- 필요하지 않은 곳에 쓰이면 클라이언트의 코드를 복잡하게만 만든다.
- 예외 상황에서 복구할 방법이 없다면 비검사 예외를 던지자.
- 복구가 가능하면서 호출자가 그 처리를 해주길 바라면, 옵셔널을 반환해도 될지 고민하자.
- 옵셔널만으로 충분한 정보를 제공할 수 없다면 검사 예외를 던지자.

- 복구할 수 있는 상황이면 검사 예외를, 프로그래밍 오류라면 비검사 예외를 던지자.
- 확실하지 않다면 비검사예외를 던지자. 
- 검사 예외도 아니고 런타임 예외도 아닌 throwable 은 정의하지도 말자. 
- 검사 예외라면 복구에 필요한 정보를 알려주는 메서드도 제공하자.