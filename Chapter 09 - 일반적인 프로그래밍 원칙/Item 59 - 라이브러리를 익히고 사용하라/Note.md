# 라이브러리를 익히고 사용하라

> 작성자: 피터
> 

표준 라이브러리를 사용하면 몇가지 이점이 있다. 

1. 그 코드를 작성한 전문가의 지식과 앞서 사용한 다른 프로그래머들의 경험을 활용할 수 있다. 
2. 핵심적인 일과 크게 관련 없는 문제를 해결하느라 시간을 허비하지 않아도 된다.
3. 크게 노력하지 않아도 성능이 지속해서 개선된다. 
4. 기능이 점점 많아진다.
5. 많은 사람에게 낯익은 코드가 된다. 

## 예제

무작위 정수 하나를 생성하고 싶을 때, 아래와 같이 프로그래머가 만들곤 한다. 

0 과 n 사이 값을 랜덤으로 출력한다. 

```java
private static Random rnd = new Random();

private static int random(int n) {
        return Math.abs(rnd.nextInt() % n);
    }
```

괜찮은 듯 보이지만 세가지 문제점이 있다.

1. n이 그리 크지 않은 2의 제곱수라면 같은 수열이 반복된다.
2. n이 2의 제곱수가 아니라면 몇몇 숫자가 평균적으로 더 자주 반환된다. 
n 값이 크면 이 현상은 더 두드러 진다.
3. 지정한 범위 외의 수가 종종 튀어나올 수 있다.

```java
public static void main(String[] args) {
        int n = 2 * (Integer.MAX_VALUE / 3);
        int low = 0;
        for (int i = 0; i < 1000000; i++) {
            if (random(n) < n / 2)
                low++;
        }
        System.out.println(low);
    }
```

위 코드가 이상적으로 동작한다면 약 50만이 출력돼야 하지만 n이 2의 제곱수가 아니라면 666,666에 가까운 값을 출력한다. 즉 무작위로 생성된 수중 2/3 가량이 중간 값보다 낮게 나온다는 것이다. 

위의 코드에서 rnd.nextInt() 가 반환한 값을 Math.abs를 이용해 음수가 아닌 정수로 매핑한다. nextInt()가 Integer.MIN_VALUE를 반환하면 Math.abs 가 Interger.MIN_VALUE를 반환하고 나머지 연산자가 음수를 반환한다. 즉 Integer.MAX_VALUE는 2147483647이지만 Integer.MIN_VALUE는 -2147483648로 abs에 의해 정수로 매핑되면 지정한 범위를 초과하기에 함수가 실패하게 된다.

이 결함을 해결하려면 의사난수 생성기, 정수론, 2의 보수 계산 등에 조예가 깊어야 한다. 하지만 라이브러리를 사용하면 이를 몰라도 쉽게 해결할 수 있다. 위의 예제에서는 `Random.nextInt(int)` 를 사용하면 된다. 

자바 7에서부터는 **Random**보다 성능이 좋은 **ThreadLocalRandom**을 사용하는 것이 좋다.

## 필수 표준 라이브러리

라이브러리가 너무 방대하여 모든 API문서를 공부하기는 벅차다. 하지만 java 프로그래머라면 `java.lang`, `java.util`, `java.io`와 그 하위 패키지들은 익숙해져야 한다. 
또한 `Collection framwork`, `Stream Library`, `java.util. concurrent` 들의 경우 유용하므로 알아두면 큰  도움이 된다. 
라이브러리는 매년 업데이트하고 있으니 모든 기능을 요약하는 것은 불가능하고 다른 라이브러리들은 필요할 때마다 익히면 된다. 

### 결론

💡 특별한 기능이 필요한 것이 아니라면 이미 라이브러리로 구현되어 있을 가능성이 크다. 라이브러리가 있는지 찾아보고 있으면 꼭 사용하자. 일반적으로 품질이 좋고, 점차 개선될 가능성이 크다.
